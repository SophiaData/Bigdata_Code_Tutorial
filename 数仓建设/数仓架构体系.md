# 1 分层定义
## 1.1 为什么要分层？

- 清晰数据结构
- 数据血缘追踪
- 减少重复开发
- 把复杂问题简单化
- 屏蔽原始数据的异常
- 屏蔽业务的影响

## 1.2 层级划分
### 1.2.1 ODS 数据来源层
数据来源层，主要包含业务数据库快照数据（db）、埋点数据(data)、其他业务等数据。

### 1.2.2 数仓模型层：

TMP：临时层， 数据处理的辅助处理层，服务于DW、DM层，主要是一些临时存储的数据,根据实际情况选择创建与不创建，包括：计算任务的中间结果数据、RAW层每日增量数据抽取临时落地等，一般最多保存1-2天即可清理。

DIM：维度数据层，主要包含一些字典表、维度数据。实例：品类字典表、城市字典表、渠道字典表、终端类型表、支付状态表、圈子列表

DW：data warehouse，存储经过标准规范化处理（即数据清洗）后的运营数据，是基础事实数据明细层。实例：后端日志明细表、前端埋点日志明细表、mysql各业务数据经过ETL处理后的表。

DWS：轻度汇总层，基于单事实表进行指标轻度加工。

DM：data market(也叫DWS：data warehouse service)，数据主题层或者宽表层，按部门按专题进行划分，支持OLAP分析、数据分发等，其信息主要来源于DW 或TMP层汇总数据。实例：新激活用户业务分析表、日活用户业务分析表、历史激活用户业务分析表、用户行为轨迹表、红包业务表、交易品类来源多维表、商业广告多维分析报表

### 1.2.3 应用数据层

ADS：application database service,应用数据层, 面向具体应用的表，要创建在这层，可导入hbase或mysql等使用。实例：按天、小时、5分钟粒度计算汇总的结果存入mysql、hbase的报表

# 2.数据流向
- 数据单向加工不可逆
- 除图里标注的流向外数据不可跨层调用

![image](https://user-images.githubusercontent.com/34996528/160243905-4ceb72ea-ca09-4807-95c5-4b371c0bccfd.png)

# 3.数仓搭建思路
- 所有数据的贴源层表都存放在 业务global 即可，业务线不需要单独维护业务线自己的贴源层。
- 所有数据源进数仓首要要落地到ods层，不可跳过贴源层在其他层直接落地和使用(手工配置表除外) 。
- 所有从数仓出去的表必须在ads首先落地，才能对外输出。
- 全局基础数据放在 global（如订单、商品、用户模型表等）下，功能包括：全局数据、清洗脏数据等
- 根据实际业务情况，业务线数据库重新定义B2C/B2B/C2C/C2B 4条，数据仓库的库单独维护，即 dw_b2c/b2b/c2c/c2b，其他业务线放在GLOBAL下即可（搜索推荐、商业等有自主搭建数仓能力的仍然是自己维护，暂时不做管控）
- 全局/业务线的沉淀大宽表、专题表、指标表放在 dm_global/b2c/b2b/c2b/c2c
- dm_global不可用不同业务线的数据的dm层，需global自己加工（目的是为了让全局有业务沉淀，有自主数据加工能力）
- 分析结果表放在 ads_global/b2c/b2b/c2b/c2c
- ads_global可组合不同业务线的数据的dm,ads层（为的是快速响应业务需求，同时个性化业务需求没必要在全局层面保留）
- 注意：对于已固化的业务：先放在global,业务线从global获取数据；对于新业务或探索性业务：先在业务线数仓满足诉求或搭建模型，待业务稳定后再完善global）


